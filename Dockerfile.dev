# Stage 1: Dependencies
FROM oven/bun:1 as deps

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    curl git \
    && rm -rf /var/lib/apt/lists/*

# Copy lock files for dependency installation
COPY package.json bun.lockb bun.lock ./

# Install dependencies
RUN bun install --frozen-lockfile

# Stage 2: Runtime
FROM deps

WORKDIR /app

# Set environment variables
ENV NODE_ENV=production
ENV NEXT_TELEMETRY_DISABLED=1
ENV STANDALONE_BUILD=true
ENV HOSTNAME=0.0.0.0
ENV PORT=3000

# Copy application code
COPY . .

# Start the application
CMD ["bun", "dev"]